<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#041a11">
    
    <title>Ù…Ù†ØµØ© Ù…ÙØµØ­ÙÙ Ø§Ù„Ù…ÙØ±ÙÙˆØ¬ Ø§Ù„Ø°ÙƒÙŠØ©</title>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Tajawal:wght@300;500;800&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            --primary: #041a11; --sidebar-bg: #052618; --accent: #c4a04d; 
            --gold-gradient: linear-gradient(135deg, #c4a04d 0%, #f1c40f 50%, #c4a04d 100%);
            --glass: rgba(255, 255, 255, 0.05);
            --gold-glow: 0 8px 32px 0 rgba(196, 160, 77, 0.3);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--primary); 
            font-family: 'Tajawal', sans-serif; 
            height: 100vh; overflow: hidden; color: #fff;
        }

        /* Ù‡ÙŠØ¯Ø± Ø¹ØµØ±ÙŠ (Professional Branding) */
        .app-header {
            background: rgba(4, 26, 17, 0.8);
            backdrop-filter: blur(15px);
            padding: 15px 20px;
            border-bottom: 1px solid rgba(196, 160, 77, 0.3);
            display: flex; flex-direction: column; align-items: center;
            position: sticky; top: 0; z-index: 1000;
        }

        .brand-container {
            display: flex; width: 100%; justify-content: space-between; align-items: center; max-width: 1200px;
        }

        .logo-box { display: flex; align-items: center; gap: 12px; }
        .logo-box img { 
            width: 48px; height: 48px; border-radius: 12px; 
            border: 2px solid var(--accent); padding: 2px; background: #fff;
            box-shadow: var(--gold-glow);
        }

        .brand-text h1 { font-family: 'Amiri'; color: var(--accent); font-size: 1.6rem; line-height: 1; }
        .brand-text span { font-size: 0.65rem; color: #aaa; letter-spacing: 1px; }

        .grade-chip {
            background: var(--gold-gradient); color: #000; padding: 4px 14px;
            border-radius: 8px; font-weight: 800; font-size: 0.75rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù†ØµØ© */
        .main-scroller {
            height: calc(100vh - 150px); overflow-y: auto; 
            background: radial-gradient(circle at top, #06311f 0%, #041a11 100%);
            padding: 20px; scroll-behavior: smooth;
        }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„ÙØµÙˆÙ„ (Modern Design) */
        .semester-tabs {
            display: flex; gap: 12px; justify-content: center; margin-bottom: 30px;
        }
        .tab-btn {
            background: var(--glass); border: 1px solid rgba(196,160,77,0.2);
            color: #fff; padding: 10px 25px; border-radius: 12px;
            cursor: pointer; transition: 0.4s; font-weight: 600;
        }
        .tab-btn.active { background: var(--gold-gradient); color: #000; border-color: transparent; transform: translateY(-2px); }

        /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© */
        .surah-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px; max-width: 1100px; margin: 0 auto;
        }

        .surah-card {
            background: var(--glass); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px; padding: 25px 15px; text-align: center;
            backdrop-filter: blur(5px); transition: 0.4s; cursor: pointer;
            position: relative; overflow: hidden;
        }
        .surah-card:hover { 
            border-color: var(--accent); transform: translateY(-8px); 
            box-shadow: var(--gold-glow); background: rgba(196, 160, 77, 0.05);
        }
        .surah-card h3 { font-family: 'Amiri'; font-size: 1.4rem; color: #fff; margin-bottom: 5px; }
        .surah-card::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: linear-gradient(45deg, transparent, rgba(196,160,77,0.1), transparent);
            transform: rotate(45deg); transition: 0.5s;
        }
        .surah-card:hover::before { left: 100%; }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø³ÙÙ„ÙŠ PWA Style */
        .bottom-nav {
            position: fixed; bottom: 0; width: 100%; background: rgba(5, 38, 24, 0.95);
            backdrop-filter: blur(10px); display: flex; justify-content: space-around;
            padding: 10px 5px 25px 5px; border-top: 1px solid rgba(196,160,77,0.3);
        }
        .nav-item {
            display: flex; flex-direction: column; align-items: center; gap: 5px;
            color: #888; text-decoration: none; font-size: 0.7rem; font-weight: 500;
            transition: 0.3s; background: none; border: none; flex: 1;
        }
        .nav-item.active { color: var(--accent); }
        .nav-item i { font-size: 1.4rem; }

        /* Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ù…Ø´ØºÙ„ (Cinema Mode) */
        .player-overlay {
            position: fixed; inset: 0; background: #000; z-index: 2000;
            display: none; flex-direction: column;
        }
        .player-header { padding: 20px; display: flex; justify-content: space-between; align-items: center; }

        /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ÙƒØ¨ÙŠØ±Ø© */
        @media (min-width: 1024px) {
            .surah-grid { grid-template-columns: repeat(4, 1fr); }
            .surah-card { padding: 50px 20px; }
        }
    </style>
</head>
<body>

    <header class="app-header">
        <div class="brand-container">
            <div class="logo-box">
                <img src="https://raw.githubusercontent.com/faissaltunisia/student-grades/main/Screenshot%202025-12-16%20235912.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø±ÙˆØ¬">
                <div class="brand-text">
                    <h1>Ù…ÙØµØ­ÙÙ Ø§Ù„Ù…ÙØ±ÙÙˆØ¬</h1>
                    <span>Ø§Ù„Ù…Ù†ØµØ© Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©</span>
                </div>
            </div>
            <div id="grade-display" class="grade-chip" onclick="openGrades()">Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³</div>
        </div>
    </header>

    <main class="main-scroller">
        <div class="semester-tabs">
            <button class="tab-btn active" id="btn-s1" onclick="changeSem(1)">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø£ÙˆÙ„</button>
            <button class="tab-btn" id="btn-s2" onclick="changeSem(2)">Ø§Ù„ÙØµÙ„ Ø§Ù„Ø«Ø§Ù†ÙŠ</button>
        </div>

        <div id="grid-container" class="surah-grid">
            </div>
    </main>

    <nav class="bottom-nav">
        <button class="nav-item active" onclick="location.reload()"><i>ğŸ </i><span>Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></button>
        <button class="nav-item" onclick="openGrades()"><i>ğŸ“š</i><span>Ø§Ù„ØµÙÙˆÙ</span></button>
        <button class="nav-item" onclick="showPrize()">
            <div id="prize-notif" style="position:absolute; top:-10px; background:red; width:10px; height:10px; border-radius:50%; display:none;"></div>
            <i>ğŸ</i><span>Ø§Ù„Ø¬Ø§Ø¦Ø²Ø©</span>
        </button>
        <button class="nav-item" onclick="showAbout()"><i>âœ¨</i><span>Ø¹Ù† Ø§Ù„Ù…Ù†ØµØ©</span></button>
    </nav>

    <div id="player-modal" class="player-overlay">
        <div class="player-header">
            <h2 id="video-title" style="font-family:'Amiri'; color:var(--accent);">Ø§Ø³Ù… Ø§Ù„Ø³ÙˆØ±Ø©</h2>
            <button onclick="closePlayer()" style="background:none; border:none; color:#fff; font-size:1.5rem;">âœ•</button>
        </div>
        <div id="video-wrapper" style="flex:1; display:flex; align-items:center; justify-content:center;">
            </div>
        <div id="progress-hud" style="padding:30px; background:rgba(0,0,0,0.5);">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <span>Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„ØªØ­Ø¯ÙŠ</span>
                <span id="progress-text">0%</span>
            </div>
            <div style="width:100%; height:6px; background:#222; border-radius:10px; overflow:hidden;">
                <div id="progress-bar" style="width:0%; height:100%; background:var(--gold-gradient); transition:0.3s;"></div>
            </div>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase (Ù†ÙØ³ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ)
        const SB_URL = 'https://vchzkeebmjqiohgoknnm.supabase.co';
        const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...'; // Ø¶Ø¹ Ù…ÙØªØ§Ø­Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„ Ù‡Ù†Ø§
        const _sb = supabase.createClient(SB_URL, SB_KEY);

        let currentGrade = "Ø§Ù„ØµÙ Ø§Ù„Ø®Ø§Ù…Ø³";
        let currentSem = 1;
        let allSurahs = [];
        let videoInstance = null;

        // 1. ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù†ØµØ© ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function startApp() {
            const { data, error } = await _sb.from('surahs').select('*');
            if (data) {
                allSurahs = data;
                renderSurahs();
            }
        }

        // 2. Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙˆØ± Ø¨ØªØµÙ…ÙŠÙ… Ø§Ø­ØªØ±Ø§ÙÙŠ
        function renderSurahs() {
            const container = document.getElementById('grid-container');
            const filtered = allSurahs.filter(s => s.grade === currentGrade && s.semester == currentSem);
            
            container.innerHTML = filtered.map(s => `
                <div class="surah-card" onclick="openVideo('${s.video_path}', '${s.title}')">
                    <h3>${s.title}</h3>
                    <small style="color:var(--accent); opacity:0.8;">Ø§Ø¶ØºØ· Ù„Ù„Ø¨Ø¯Ø¡</small>
                </div>
            `).join('');
        }

        // 3. Ù†Ø¸Ø§Ù… ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ù…ØªØ·ÙˆØ± (Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†Ø¸ÙŠÙØ©)
        function openVideo(url, title) {
            document.getElementById('player-modal').style.display = 'flex';
            document.getElementById('video-title').innerText = title;
            const wrapper = document.getElementById('video-wrapper');
            
            // Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ø¨Ø¹ Ø²Ù…Ù†ÙŠ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ¯Ø§Ø®Ù„
            const cleanUrl = url.includes('?') ? `${url}&t=${Date.now()}` : `${url}?t=${Date.now()}`;

            if(url.includes('youtube')) {
                const id = url.split('v=')[1];
                wrapper.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1" style="width:100%; height:100%; border:none;"></iframe>`;
            } else {
                const video = document.createElement('video');
                video.src = cleanUrl;
                video.controls = true;
                video.autoplay = true;
                video.playsInline = true;
                video.style.width = "100%";
                wrapper.appendChild(video);
                videoInstance = video;
                
                video.ontimeupdate = () => {
                    let p = Math.floor((video.currentTime / video.duration) * 100);
                    updateProgress(p);
                };
            }
        }

        function updateProgress(p) {
            document.getElementById('progress-text').innerText = p + '%';
            document.getElementById('progress-bar').style.width = p + '%';
            if(p >= 75) document.getElementById('prize-notif').style.display = 'block';
        }

        function closePlayer() {
            const wrapper = document.getElementById('video-wrapper');
            if(videoInstance) {
                videoInstance.pause();
                videoInstance.src = "";
                videoInstance.load();
                videoInstance.remove();
            }
            wrapper.innerHTML = "";
            document.getElementById('player-modal').style.display = 'none';
        }

        function changeSem(s) {
            currentSem = s;
            document.getElementById('btn-s1').classList.toggle('active', s === 1);
            document.getElementById('btn-s2').classList.toggle('active', s === 2);
            renderSurahs();
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù€ Service Worker Ù„ØªÙ…Ø«ÙŠÙ„ Ø§Ù„Ù€ PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').catch(() => {});
            });
        }

        startApp();
    </script>
</body>
</html>
